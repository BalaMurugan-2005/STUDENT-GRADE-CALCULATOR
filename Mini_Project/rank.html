<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Rankings</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 15px; }
        .container { padding: 20px; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
        .rank-1 { background: gold; }
        .rank-2 { background: silver; }
        .rank-3 { background: #cd7f32; }
        .filter { margin: 20px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h2>Student Rankings</h2>
    </div>

    <div class="container">
        <div class="filter">
            <label>Filter by Class:</label>
            <select id="classFilter" onchange="filterRankings()">
                <option value="all">All Classes</option>
                <option value="10A">10A</option>
                <option value="10B">10B</option>
            </select>
        </div>

        <div class="card">
            <h3>Student Rankings</h3>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Name</th>
                        <th>Registration No</th>
                        <th>Class</th>
                        <th>Total Marks</th>
                        <th>Percentage</th>
                        <th>Grade</th>
                    </tr>
                </thead>
                <tbody id="rankingsTable">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allRankings = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadRankings();
        });

        function loadRankings() {
            fetch('../json/studentmarksdetails.json')
                .then(response => response.json())
                .then(data => {
                    allRankings = calculateRankings(data.marks);
                    displayRankings(allRankings);
                });
        }

        function calculateRankings(marksData) {
            const studentsWithTotals = marksData.map(student => {
                const subjects = student.subjects;
                const total = Object.values(subjects).reduce((sum, mark) => sum + mark, 0);
                const percentage = (total / (Object.keys(subjects).length * 100)) * 100;
                const grade = calculateGrade(percentage);
                
                return {
                    ...student,
                    total,
                    percentage,
                    grade
                };
            });

            // Sort by total marks (descending)
            return studentsWithTotals.sort((a, b) => b.total - a.total);
        }

        function displayRankings(rankings) {
            const table = document.getElementById('rankingsTable');
            table.innerHTML = '';
            
            rankings.forEach((student, index) => {
                const row = document.createElement('tr');
                const rank = index + 1;
                
                let rowClass = '';
                if (rank === 1) rowClass = 'rank-1';
                else if (rank === 2) rowClass = 'rank-2';
                else if (rank === 3) rowClass = 'rank-3';
                
                row.className = rowClass;
                row.innerHTML = `
                    <td>${rank}</td>
                    <td>${student.name}</td>
                    <td>${student.regno}</td>
                    <td>${student.class}</td>
                    <td>${student.total}</td>
                    <td>${student.percentage.toFixed(2)}%</td>
                    <td>${student.grade}</td>
                `;
                table.appendChild(row);
            });
        }

        function filterRankings() {
            const selectedClass = document.getElementById('classFilter').value;
            
            if (selectedClass === 'all') {
                displayRankings(allRankings);
            } else {
                const filtered = allRankings.filter(student => student.class === selectedClass);
                displayRankings(filtered);
            }
        }

        function calculateGrade(percentage) {
            if (percentage >= 90) return 'A+';
            if (percentage >= 80) return 'A';
            if (percentage >= 70) return 'B';
            if (percentage >= 60) return 'C';
            if (percentage >= 50) return 'D';
            if (percentage >= 40) return 'E';
            return 'F';
        }
    </script>
</body>
</html>